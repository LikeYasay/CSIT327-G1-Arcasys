{% extends "base.html" %}
{% load static %}

{% block title %}Events | Marketing Archive{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'events/css/events.css' %}" />
<link rel="stylesheet" href="{% static 'events/css/add_events.css' %}" />
<style>
    /* Red error message styling */
    .alert-error {
        color: #dc3545;
        border-radius: 8px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .alert-error::before {
        font-size: 16px;
    }

    /* Red border for search container when there's an error */
    .search-bar.error {
        border: 2px solid #dc3545 !important;
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1) !important;
    }
</style>
{% endblock %}

{% block content %}
<section class="events-container">
  <h1 class="page-title">Search for Events</h1>

  <!-- Django messages for empty search error -->
  {% if messages %}
    <div class="messages">
      {% for message in messages %}
        <div class="alert alert-error">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="search-bar {% if messages %}error{% endif %}">
    <img
    src="{% static 'events/images/search-icon.png' %}"
    alt="Search Icon"
    class="search-icon"
    style="width:18px;height:18px;max-width:18px;max-height:18px;flex:0 0 18px;display:block;object-fit:contain;margin-right:10px;"
    />
    <!-- Updated search form with proper method and action -->
    <form method="get" action="{% url 'events:events' %}" style="display: flex; width: 100%;">
        <input type="text" name="q" placeholder="Search events, departments, tags..." 
               value="{{ search_query|default:'' }}" />
        <button type="submit" style="display: none;">Search</button>
    </form>
  </div>

  <div class="filters">
    <div class="filter">
      <label for="department">Office/Department</label>
      <select id="department">
              <option value="" disabled selected>Select office/department</option>
              <option value="MO">Marketing Office (MO)</option>
              <option value="URO">University Registrar's Office (URO)</option>
              <option value="OAS">Office of Admissions & Scholarships (OAS)</option>
              <option value="ETO">Enrollment Technical Office (ETO)</option>
              <option value="FAO">Finance & Accounting Office (FAO)</option>
              <option value="SSO">Student Success Office (SSO)</option>
              <option value="TSG">Technical Support Group (TSG)</option>
              <option value="GC">Guidance Center</option>

              <option value="CEA">CEA</option>
              <option value="CCS">CCS</option>
              <option value="CASE">CASE</option>
              <option value="CMBA">CMBA</option>
              <option value="CNAHS">CNAHS</option>
              <option value="CCJ">CCJ</option>
      </select>
    </div>

    <div class="filter">
      <label for="platform">Platform</label>
      <select id="platform">
        <option>All Platforms</option>
        <option>Zoom</option>
        <option>Teams</option>
        <option>Onsite</option>
      </select>
    </div>

    <div class="filter">
      <label for="fromYear">From Year</label>
      <select id="fromYear">
        <option>2020</option>
        <option>2021</option>
        <option>2022</option>
        <option>2023</option>
      </select>
    </div>

    <div class="filter">
      <label for="toYear">To Year</label>
      <select id="toYear">
        <option>2020</option>
        <option>2021</option>
        <option>2022</option>
        <option>2023</option>
      </select>
    </div>

    <div class="filter-buttons">
      <button class="btn apply">Apply Filters</button>
      <button class="btn clear">Clear All</button>
      <button class="btn export">Export to CSV</button>
    </div>
  </div>

  <div class="results-wrapper">

    <aside class="sidebar">
      <h3 class="sidebar-title">Recent Events</h3>
      <ul class="event-list">
        <li><a href="#">Forum on Anti-Corruption…</a></li>
        <li><a href="#">Student Organizations …</a></li>
        <li><a href="#">#CITUEvents: Honoring…</a></li>
        <li><a href="#">CIT University particip…</a></li>
        <li><a href="#">College of Computer …</a></li>
        <li><a href="#">MarketED Talks: Shap…</a></li>
        <li><a href="#">Campus Bazaar: Mark…</a></li>
        <li><a href="#">Pitch Masters: Academ…</a></li>
        <li><a href="#">The Strategy Sessions…</a></li>
      </ul>
    </aside>

    <div class="results-content">
      <!-- DYNAMIC HEADER BASED ON USER ROLE -->
      {% if request.user.isUserAdmin or request.user.isUserStaff %}
        {% block results_header_content %}
        <!-- ADMIN HEADER -->
        <div class="results-header-admin">
            <div class="results-header-top">
                <h2>Event Results</h2>
                <a href="{% url 'events:add_event' %}" class="add-event">Add Event</a>
            </div>
            
            <div class="results-header-bottom">
                <p class="results-meta">Showing 10 of 197 events (Page 1 of 20)</p>
                <span class="results-date">2025 | September</span>
            </div>
        </div>
        {% endblock results_header_content %}
      {% else %}
        <!-- REGULAR USER HEADER -->
        <div class="results-header">
          <h2>Event Results</h2>
          <span class="results-date">2025 | September</span>
        </div>
        <p class="results-meta">Showing 10 of 197 events (Page 1 of 20)</p>
      {% endif %}

      <!-- EVENT CARD 1 -->
      <div class="event-card">
        <div class="event-card-header">
          <h3 class="event-title">
            Student Organizations Accreditation Ceremony
          </h3>
          <span class="event-date">📅 September 5, 2025</span>
        </div>
        <p class="event-department">Students Success Office</p>
        
        <!-- TAGS AND ACTIONS ROW -->
        {% if request.user.isUserAdmin or request.user.isUserStaff %}
          {% block admin_actions_1 %}
          <!-- TAGS AND ACTIONS ROW FOR EVENT 1 -->
          <div class="tags-and-actions-row">
              <div class="tags">
                  <span class="tag green">SSO</span>
                  <span class="tag green">LeadTheFuture</span>
                  <span class="tag green">Organizations</span>
              </div>
              
              <!-- ADMIN ACTIONS INLINE -->
              <div class="admin-actions-inline">
                  <a href="#" class="action-btn export">Export</a>
                  <a href="{% url 'events:edit_event' %}" class="action-btn edit">Edit</a>
                  {% if request.user.isUserAdmin %}
                  <a href="#" class="action-btn delete">Delete</a>
                  {% endif %}
              </div>
          </div>
          {% endblock admin_actions_1 %}
        {% else %}
          <!-- REGULAR USER TAGS ONLY -->
          <div class="tags">
            <span class="tag green">SSO</span>
            <span class="tag green">LeadTheFuture</span>
            <span class="tag green">Organizations</span>
          </div>
        {% endif %}
        
        <p class="event-desc">
          Because we <strong>#LeadTheFuture</strong>, WATCH the Wildcat leadership SHINE
          as our student leaders from the different CIT-U accredited student organizations
          receive their accreditation confirmation in a symbolic ceremony. Go, Wildcats!
        </p>
        <div class="platforms">
          <span class="platform">Facebook</span>
          <span class="platform">Instagram</span>
          <span class="platform">Tiktok</span>
          <span class="platform">YouTube</span>
        </div>
      </div>

      <!-- EVENT CARD 2 -->
      <div class="event-card">
        <div class="event-card-header">
          <h3 class="event-title">
            #CITUEvents: Honoring our athletes in the Wildcats' …
          </h3>
          <span class="event-date">📅 September 1, 2025</span>
        </div>
        <p class="event-department">PE Department</p>
        
        <!-- TAGS AND ACTIONS ROW -->
        {% if request.user.isUserAdmin or request.user.isUserStaff %}
          {% block admin_actions_2 %}
          <!-- TAGS AND ACTIONS ROW FOR EVENT 2 -->
          <div class="tags-and-actions-row">
              <div class="tags">
                  <span class="tag green">LeadTheFuture</span>
                  <span class="tag green">redefinethetop</span>
                  <span class="tag green">CITTopsAgain</span>
                  <span class="tag green">CITforSDG</span>
              </div>
              
              <!-- ADMIN ACTIONS INLINE -->
              <div class="admin-actions-inline">
                  <a href="#" class="action-btn export">Export</a>
                  <a href="{% url 'events:edit_event' %}" class="action-btn edit">Edit</a>
                  {% if request.user.isUserAdmin %}
                  <a href="#" class="action-btn delete">Delete</a>
                  {% endif %}
              </div>
          </div>
          {% endblock admin_actions_2 %}
        {% else %}
          <!-- REGULAR USER TAGS ONLY -->
          <div class="tags">
            <span class="tag green">LeadTheFuture</span>
            <span class="tag green">redefinethetop</span>
            <span class="tag green">CITTopsAgain</span>
            <span class="tag green">CITforSDG</span>
          </div>
        {% endif %}
        
        <p class="event-desc">
          Because we <strong>#LeadTheFuture</strong>, WATCH the Wildcat leadership SHINE
          as our student leaders from the different CIT-U accredited student organizations
          receive their accreditation confirmation in a symbolic ceremony. Go, Wildcats!
        </p>
        <div class="platforms">
          <span class="platform">Facebook</span>
          <span class="platform">Instagram</span>
          <span class="platform">Tiktok</span>
          <span class="platform">YouTube</span>
        </div>
      </div>

      <div class="pagination">
        <button class="btn prev">← Previous</button>
        <button class="btn next">Next →</button>
      </div>
    </div>
  </div>
</section>
{% endblock %}