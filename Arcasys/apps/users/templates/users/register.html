{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/register.css' %}" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    .register-card {
        min-width: 400px !important;
        max-width: 450px !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }

    /* Server-side error styling */
    .server-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 12px 15px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: 600;
    }

    /* Field error styling */
    .field-error {
        color: #dc3545;
        font-size: 14px;
        margin-top: 5px;
        display: block;
    }

    .error-border {
        border: 2px solid #dc3545 !important;
        border-radius: 8px;
    }

    /* Remove old message styling */
    .messages {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="register-container">

  <div class="register-left">
    <header class="register-header">
      <div class="logo-section">
        <img src="{% static 'shared/images/CIT_LOGO.png' %}" alt="CIT Logo" class="logo" />
        <div class="logo-text">
          <h1>MARKETING ARCHIVE</h1>
          <p>Event Management System</p>
        </div>
      </div>
      <a href="{% url 'marketing:landing' %}" class="back-link">‚Üê Back</a>
    </header>
    <div class="register-card">
      <h1>Welcome</h1>
      <p class="description">Enter your details to create an account as staff.</p>

      <!-- Server-side errors (non-bulleted) -->
      {% for message in messages %}
        {% if 'server_error' in message.tags %}
          <div class="server-error">
            {{ message }}
          </div>
        {% endif %}
      {% endfor %}

      <!-- Register Form -->
      <form method="POST" autocomplete="off">
        {% csrf_token %}

        <!-- Hidden fake fields for autofill prevention -->
        <input type="text" name="fake_username" style="display:none">
        <input type="password" name="fake_password" style="display:none">

        <div class="name-fields">
          <div class="field">
            <label for="first_name">First Name</label>
            <input 
              type="text" 
              name="first_name" 
              id="first_name" 
              placeholder="Enter your first name" 
              required 
              autocomplete="given-name"
              readonly onfocus="this.removeAttribute('readonly')"
              value="{% if not clear_fields.first_name %}{{ form_data.first_name|default:'' }}{% endif %}"
              class="{% if field_errors.first_name %}error-border{% endif %}"
            >
            {% if field_errors.first_name %}
              <span class="field-error">{{ field_errors.first_name }}</span>
            {% endif %}
          </div>
          <div class="field">
            <label for="last_name">Last Name</label>
            <input 
              type="text" 
              name="last_name" 
              id="last_name" 
              placeholder="Enter your last name" 
              required 
              autocomplete="family-name"
              readonly onfocus="this.removeAttribute('readonly')"
              value="{% if not clear_fields.last_name %}{{ form_data.last_name|default:'' }}{% endif %}"
              class="{% if field_errors.last_name %}error-border{% endif %}"
            >
            {% if field_errors.last_name %}
              <span class="field-error">{{ field_errors.last_name }}</span>
            {% endif %}
          </div>
        </div>

        <label for="email">Email</label>
        <input 
          type="email" 
          name="email" 
          id="email" 
          placeholder="Enter your email" 
          required 
          autocomplete="email"
          readonly onfocus="this.removeAttribute('readonly')"
          value="{% if not clear_fields.email %}{{ form_data.email|default:'' }}{% endif %}"
          class="{% if field_errors.email %}error-border{% endif %}"
        >
        {% if field_errors.email %}
          <span class="field-error">{{ field_errors.email }}</span>
        {% endif %}

        <label for="password">Password</label>
        <div class="password-wrapper">
          <input 
            type="password" 
            name="password" 
            id="password" 
            placeholder="Enter your password" 
            required 
            autocomplete="new-password"
            readonly onfocus="this.removeAttribute('readonly')"
            value="{% if not clear_fields.password %}{{ form_data.password|default:'' }}{% endif %}"
            class="{% if field_errors.password %}error-border{% endif %}"
          >
          <span class="toggle-password">
            <i class="fas fa-eye-slash" id="togglePasswordIcon"></i>
          </span>
        </div>
        {% if field_errors.password %}
          <span class="field-error">{{ field_errors.password }}</span>
        {% endif %}

        <label for="confirm_password">Confirm Password</label>
        <div class="password-wrapper">
          <input 
            type="password" 
            name="confirm_password" 
            id="confirm_password" 
            placeholder="Confirm your password" 
            required 
            autocomplete="new-password"
            readonly onfocus="this.removeAttribute('readonly')"
            value="{% if not clear_fields.confirm_password %}{{ form_data.confirm_password|default:'' }}{% endif %}"
            class="{% if field_errors.confirm_password %}error-border{% endif %}"
          >
          <span class="toggle-password">
            <i class="fas fa-eye-slash" id="toggleConfirmPasswordIcon"></i>
          </span>
        </div>
        {% if field_errors.confirm_password %}
          <span class="field-error">{{ field_errors.confirm_password }}</span>
        {% endif %}

        <button type="submit" class="btn-register">Sign up</button>
      </form>

      <p class="signup-text">
        Already have an account? <a href="{% url 'users:login' %}">Login</a>
      </p>
    </div>
  </div>

  <div class="register-right">
    <img src="{% static 'marketing/images/Library.jpg' %}" alt="Campus Building">
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Password visibility toggles
    const togglePwd = document.getElementById("togglePasswordIcon");
    const pwdInput = document.getElementById("password");
    if (togglePwd && pwdInput) {
      togglePwd.addEventListener("click", function() {
        const type = pwdInput.getAttribute("type") === "password" ? "text" : "password";
        pwdInput.setAttribute("type", type);
        this.classList.toggle("fa-eye-slash");
        this.classList.toggle("fa-eye");
      });
    }

    const toggleConfirm = document.getElementById("toggleConfirmPasswordIcon");
    const confirmInput = document.getElementById("confirm_password");
    if (toggleConfirm && confirmInput) {
      toggleConfirm.addEventListener("click", function() {
        const type = confirmInput.getAttribute("type") === "password" ? "text" : "password";
        confirmInput.setAttribute("type", type);
        this.classList.toggle("fa-eye-slash");
        this.classList.toggle("fa-eye");
      });
    }
  });
</script> 
{% endblock %}