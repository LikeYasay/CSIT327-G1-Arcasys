{% extends "base.html" %}
{% load static %}

{% block title %}Backup History | Marketing Archive{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'events/css/backup_history.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-container">

  <!-- TABS -->
  <div class="tabs">
    <button class="tab" onclick="window.location.href='{% url 'events:backup_dashboard' %}'">Status</button>
    <button class="tab">System Logs</button>
    <button class="tab active" onclick="window.location.href='{% url 'events:backup_history' %}'">Backup History</button>
  </div>

  <!-- BACKUP HISTORY SECTION -->
  <section class="backup-history">
    <div class="section-header">
      <h3>Backup History</h3>
      <button class="btn-green">Export to CSV</button>
    </div>

    <!-- FILTER BAR -->
    <div class="filters">
      <input type="text" placeholder="Search backups...">
      <select>
        <option>All Status</option>
        <option>Completed</option>
        <option>Failed</option>
      </select>
      <select>
        <option>All Types</option>
        <option>Database</option>
        <option>File System</option>
        <option>Configuration</option>
      </select>
    </div>

    <!-- BACKUP TABLE -->
    <div class="table-container">
      <table class="backup-table">
        <thead>
          <tr>
            <th>Backup Name</th>
            <th>Status</th>
            <th>Timestamp</th>
            <th>Size</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% if backups %}
            {% for backup in backups %}
              <tr>
                <td>{{ backup.name }}</td>
                <td>
                  {% if backup.status == "completed" %}
                    <span class="status success">Completed</span>
                  {% else %}
                    <span class="status failed">Failed</span>
                  {% endif %}
                </td>
                <td>{{ backup.timestamp|date:"M d, Y h:i A" }}</td>
                <td>{{ backup.size }}</td>
                <td class="actions">
                  {% if backup.backup_file %}
                    <a href="{% url 'events:download_backup' backup.BackupHistoryID %}?file_type=backup" class="download">Download</a>
                  {% endif %}
                  {% if backup.log_file %}
                    <a href="{% url 'events:download_backup' backup.BackupHistoryID %}?file_type=log" class="view">View Log</a>
                  {% endif %}
                  <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="delete_id" value="{{ backup.BackupHistoryID }}">
                    <button type="submit" class="delete" onclick="return confirm('Delete this backup?')">Delete</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" style="text-align:center;">No backups found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div class="pagination">
      <button class="btn-gray">Previous</button>
      <button class="btn-maroon">Next</button>
    </div>
  </section>
</div>
{% endblock %}