{% extends "base.html" %}
{% load static %}

{% block title %}Restore Operations | Marketing Archive{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'events/css/restore_operations.css' %}">
{% endblock %}

{% block content %}
<meta name="csrf-token" content="{{ csrf_token }}">

<div class="dashboard-container">
  <div class="tabs">
    <button class="tab" onclick="window.location.href='{% url 'events:backup_dashboard' %}'">Status</button>
    <button class="tab" onclick="window.location.href='{% url 'events:backup_history' %}'">History</button>
    <button class="tab active" onclick="window.location.href='{% url 'events:restore_operations' %}'">Restore</button>
  </div>

  <section class="backup-content">
    <div class="backup-header">
      <div>
        <h3>Restore Operations</h3>
        <p>Monitor and manage data restoration processes</p>
      </div>
    </div>

    <!-- Active Restore Card -->
    <div id="restoreCard" class="restore-card hidden">
      <div class="restore-header">
        <h2 id="restoreTitle">Database Restoration</h2>
        <a href="#" class="details-link">View Details</a>
      </div>
      
      <div class="restore-content">
        <div class="status-section">
          <div class="status-header">
            <div id="statusBadge" class="status-badge yellow">In Progress</div>
            <p id="progressLabel" class="progress-label">Progress: 0%</p>
          </div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill yellow" style="width: 0%;"></div>
          </div>
          <p id="restoreMessage" class="restore-message">Starting restoration...</p>
        </div>
        
        <div class="time-info">
          <div class="time-item">
            <span class="time-label">Start Time:</span>
            <span id="startTime" class="time-value">{{ current_time|date:"Y-m-d H:i" }}</span>
          </div>
          <div class="time-item">
            <span class="time-label">Completion Time:</span>
            <span id="estimatedCompletion" class="time-value">--:--</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Available Backups -->
    <div class="available-section">
      <h2>Available Backups for Restoration</h2>
      <div class="available-grid">
        {% for backup in backups %}
        <div class="available-card">
          <div>
            <h3>{{ backup.BackupName }}</h3>
            <p>{{ backup.BackupTimestamp|date:"Y-m-d H:i" }} — {{ backup.BackupSize }}</p>
          </div>
          <button class="restore-link" onclick="startRestore('{{ backup.BackupHistoryID }}')">Restore</button>
        </div>
        {% empty %}
        <p>No backups available for restoration.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      {% if backups.has_previous %}
        <a class="page-btn prev" href="?page={{ backups.previous_page_number }}">← Previous</a>
      {% endif %}

      <span class="current-page">
        Page {{ backups.number }} of {{ backups.paginator.num_pages }}
      </span>

      {% if backups.has_next %}
        <a class="page-btn next" href="?page={{ backups.next_page_number }}">Next →</a>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
